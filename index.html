<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>What A App - Devendrabhai Edition</title>
<style>
:root{--bg:#f0f2f5;--panel:#fff;--text:#111;--muted:#667;--accent:#25D366;--accent-dark:#128C7E;--bubble-me:#d9fdd3;--bubble-them:#fff;--border:#e5e7eb;--blue:#34b7f1;}
.dark{--bg:#0b141a;--panel:#111b21;--text:#e9edef;--muted:#aebac1;--bubble-me:#005c4b;--bubble-them:#202c33;--border:#1f2c34;}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,sans-serif;overflow:hidden;}

/* Splash */
#splash{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#25D366;color:#fff;z-index:9999;transition:opacity .5s;}

/* App Layout */
.app{display:flex;flex-direction:column;height:100vh;}
.content{display:grid;grid-template-columns:360px 1fr;height:100%;min-height:0;}
@media(max-width:900px){.content{grid-template-columns:1fr;} #chatPanel{display:none;position:fixed;inset:0;z-index:100;background:var(--bg);}}

/* Side Panel */
.panel{background:var(--panel);border-right:1px solid var(--border);display:flex;flex-direction:column;}
.topbar{display:flex;align-items:center;gap:12px;padding:12px;border-bottom:1px solid var(--border);background:var(--panel);flex-shrink:0;}
.avatar{width:42px;height:42px;border-radius:50%;object-fit:cover;background:var(--accent-dark);display:grid;place-items:center;color:white;font-weight:bold;flex-shrink:0;}

/* List Area */
.list-container{flex:1;overflow-y:auto;}
.row{display:flex;align-items:center;padding:12px;border-bottom:1px solid var(--border);cursor:pointer;transition: 0.2s;}
.row:hover{background:rgba(0,0,0,0.05);}

/* Chat UI */
.messages{flex:1;overflow-y:auto;padding:20px;background-color:#e5ddd5;background-image:url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');display:flex;flex-direction:column;}
.bubble{max-width:75%;padding:8px 12px;border-radius:12px;margin:4px 0;font-size:15px;position:relative;line-height:1.4;}
.me{align-self:flex-end;background:var(--bubble-me);border-top-right-radius:2px;}
.them{align-self:flex-start;background:var(--bubble-them);border-top-left-radius:2px;}
.m-meta{font-size:10px;color:var(--muted);text-align:right;margin-top:4px;display:flex;justify-content:flex-end;gap:3px;align-items:center;}
.tick{color:var(--blue);font-weight:bold;font-size:14px;}

/* Input Area */
.composer{padding:10px;background:var(--panel);display:flex;align-items:center;gap:10px;border-top:1px solid var(--border);}
.composer input{flex:1;padding:12px;border-radius:25px;border:none;background:var(--bg);color:var(--text);outline:none;}
.icon-btn{font-size:20px;cursor:pointer;color:var(--muted);padding:5px;}

/* Footer & Credit */
.footer{display:flex;background:var(--panel);border-top:1px solid var(--border);padding:8px 0;flex-shrink:0;}
.tab-btn{flex:1;text-align:center;background:none;border:none;color:var(--muted);font-size:11px;cursor:pointer;}
.tab-btn.active{color:var(--accent-dark);font-weight:bold;}
.credit-bar{font-size:10px;text-align:center;padding:4px;background:var(--border);color:var(--muted);font-weight:bold;}

/* Modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:200;}
.modal-content{background:var(--panel);padding:20px;border-radius:15px;width:90%;max-width:350px;}
</style>
</head>
<body>

<div id="splash">
    <div style="font-size:50px;margin-bottom:10px;">ğŸ’¬</div>
    <h2 style="margin:0">What A App</h2>
    <p>Created by Devendrabhai ğŸ™</p>
</div>

<div class="app">
  <div class="content">
    <section class="panel">
      <div class="topbar">
        <div class="avatar">D</div>
        <b id="pTitle">What A App</b>
        <div style="flex:1"></div>
        <span class="icon-btn" onclick="openModal()">â•</span>
      </div>
      
      <div class="list-container" id="mainList"></div>

      <div class="credit-bar">Â© Devendrabhai | Vidushi Bot v2.0</div>
      
      <nav class="footer">
        <button class="tab-btn active" onclick="switchTab('chat')">ğŸ’¬<br>àªšà«‡àªŸ</button>
        <button class="tab-btn" onclick="switchTab('update')">ğŸ””<br>àª…àªªàª¡à«‡àªŸ</button>
        <button class="tab-btn" onclick="switchTab('comm')">ğŸ‘¥<br>àª•à«‹àª®à«àª¯à«àª¨àª¿àªŸà«€</button>
        <button class="tab-btn" onclick="switchTab('set')">âš™ï¸<br>àª¸à«‡àªŸàª¿àª‚àª—à«àª¸</button>
      </nav>
    </section>

    <section class="panel" id="chatPanel">
      <div class="topbar">
        <button class="icon-btn" onclick="closeChat()" id="backBtn">â¬…ï¸</button>
        <div id="activeProfile">
            <img id="chatImg" class="avatar" src="" style="display:none">
            <div id="chatInitial" class="avatar">?</div>
        </div>
        <div style="margin-left:5px">
          <b id="activeName">àªšà«‡àªŸ àªªàª¸àª‚àª¦ àª•àª°à«‹</b><br>
          <small id="lastSeen" style="color:var(--accent-dark);font-size:11px;display:none;">Online</small>
        </div>
      </div>

      <div class="messages" id="msgBox"></div>

      <div class="composer">
        <span class="icon-btn">ğŸ˜Š</span>
        <span class="icon-btn">ğŸ“</span>
        <input type="text" id="mInput" placeholder="àª®à«‡àª¸à«‡àªœ àª²àª–à«‹...">
        <span class="icon-btn">ğŸ“·</span>
        <button onclick="sendMsg()" style="border:none;background:none;color:var(--accent-dark);font-weight:bold;cursor:pointer;padding:10px;">àª®à«‹àª•àª²à«‹</button>
      </div>
    </section>
  </div>
</div>

<div class="modal" id="addModal">
  <div class="modal-content">
    <h3>àª¨àªµà«‹ àª¸àª‚àªªàª°à«àª• àª‰àª®à«‡àª°à«‹</h3>
    <input type="text" id="nName" placeholder="àª¨àª¾àª® àª²àª–à«‹" style="width:100%;padding:10px;margin-bottom:12px;border:1px solid var(--border);border-radius:8px;">
    <p style="font-size:12px;margin:0 0 5px 0;">àªªà«àª°à«‹àª«àª¾àªˆàª² àª«à«‹àªŸà«‹ àªªàª¸àª‚àª¦ àª•àª°à«‹:</p>
    <input type="file" id="nImg" accept="image/*" style="margin-bottom:15px;width:100%;">
    <button onclick="saveContact()" style="width:100%;padding:12px;background:var(--accent-dark);color:white;border:none;border-radius:8px;font-weight:bold;cursor:pointer;">àª¸à«‡àªµ àª•àª°à«‹</button>
    <button onclick="closeModal()" style="width:100%;padding:10px;background:none;border:none;color:red;margin-top:5px;cursor:pointer;">àª°àª¦ àª•àª°à«‹</button>
  </div>
</div>

<script>
// Data State
let state = JSON.parse(localStorage.getItem('wa_final_edition')) || {
  contacts: [{id:1, name:"àª®àª¿àª¤à«àª°", img:null, lastMsg:"àªœàª¯ àª¶à«àª°à«€ àª•à«ƒàª·à«àª£"}],
  chats: {1:[]},
  theme: 'light'
};
let curId = null;

// Render Functions
function renderList() {
  const list = document.getElementById('mainList');
  list.innerHTML = '';
  state.contacts.forEach(c => {
    const d = document.createElement('div');
    d.className = 'row';
    d.onclick = () => openChat(c);
    const imgHtml = c.img ? `<img src="${c.img}" class="avatar">` : `<div class="avatar">${c.name[0]}</div>`;
    d.innerHTML = `
        ${imgHtml}
        <div style="margin-left:12px;flex:1;min-width:0;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
                <b style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${c.name}</b>
                <span style="font-size:10px;color:var(--muted)">10:30 AM</span>
            </div>
            <small style="color:var(--muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:block;">${c.lastMsg}</small>
        </div>`;
    list.appendChild(d);
  });
}

function openChat(c) {
  curId = c.id;
  document.getElementById('activeName').innerText = c.name;
  document.getElementById('lastSeen').style.display = 'block';
  
  const imgEl = document.getElementById('chatImg');
  const initEl = document.getElementById('chatInitial');
  
  if(c.img) {
    imgEl.src = c.img;
    imgEl.style.display = 'block';
    initEl.style.display = 'none';
  } else {
    imgEl.style.display = 'none';
    initEl.style.display = 'grid';
    initEl.innerText = c.name[0];
  }
  
  if(window.innerWidth <= 900) {
    document.getElementById('chatPanel').style.display = 'flex';
  }
  renderMessages();
}

function renderMessages() {
  const box = document.getElementById('msgBox');
  box.innerHTML = '';
  const time = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
  
  (state.chats[curId] || []).forEach(m => {
    const b = document.createElement('div');
    b.className = `bubble ${m.from}`;
    // âœ“âœ“ Blue Tick Logic
    const tick = m.from === 'me' ? '<span class="tick">âœ“âœ“</span>' : '';
    b.innerHTML = `<div>${m.text}</div><div class="m-meta">${time} ${tick}</div>`;
    box.appendChild(b);
  });
  box.scrollTop = box.scrollHeight;
}

function sendMsg() {
  const i = document.getElementById('mInput');
  if(!i.value || !curId) return;
  if(!state.chats[curId]) state.chats[curId] = [];
  
  state.chats[curId].push({from:'me', text:i.value});
  state.contacts.find(c => c.id === curId).lastMsg = i.value;
  
  const val = i.value;
  i.value = '';
  saveState(); renderMessages(); renderList();
}

// Modal & UI Helper
function saveContact() {
  const name = document.getElementById('nName').value;
  const file = document.getElementById('nImg').files[0];
  if(!name) return;

  if(file) {
    const reader = new FileReader();
    reader.onload = (e) => {
        finalizeContact(name, e.target.result);
    };
    reader.readAsDataURL(file);
  } else {
    finalizeContact(name, null);
  }
}

function finalizeContact(name, imgData) {
    const id = Date.now();
    state.contacts.push({id, name, img: imgData, lastMsg: ''});
    state.chats[id] = [];
    saveState(); renderList(); closeModal();
}

function saveState() { localStorage.setItem('wa_final_edition', JSON.stringify(state)); }
function openModal() { document.getElementById('addModal').style.display = 'flex'; }
function closeModal() { document.getElementById('addModal').style.display = 'none'; document.getElementById('nName').value=''; }
function closeChat() { document.getElementById('chatPanel').style.display = 'none'; }
function switchTab(t) { 
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    event.currentTarget.classList.add('active');
    document.getElementById('pTitle').innerText = t === 'chat' ? 'What A App' : t.toUpperCase(); 
}

// Startup
window.onload = () => {
  renderList();
  setTimeout(() => {
      const sp = document.getElementById('splash');
      sp.style.opacity = '0';
      setTimeout(() => sp.remove(), 500);
  }, 1200);
};
</script>
</body>
</html>
