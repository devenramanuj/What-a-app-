<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0c2461, #1e3799);
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 400px;
            background: #fff;
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .header h1 {
            color: #0c2461;
            font-size: 1.8rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .app-name {
            background: linear-gradient(135deg, #0c2461, #3498db);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 1.3rem;
        }
        
        .header p {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* કેલ્ક્યુલેટર ડિસ્પ્લે */
        .calculator-display {
            background: #222;
            color: #fff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: right;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        .calculation-display {
            font-size: 1.2rem;
            color: #aaa;
            min-height: 30px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            direction: ltr;
        }
        
        .result-display {
            font-size: 2.5rem;
            font-weight: bold;
            min-height: 50px;
            direction: ltr;
        }
        
        /* કેલ્ક્યુલેટર બટન્સ */
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .calc-btn {
            height: 70px;
            border: none;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .calc-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }
        
        .calc-btn:active {
            transform: translateY(1px);
        }
        
        .number {
            background: #f8f9fa;
            color: #333;
        }
        
        .operator {
            background: #f1c40f;
            color: #000;
        }
        
        .function {
            background: #95a5a6;
            color: white;
        }
        
        .equals {
            background: #2ecc71;
            color: white;
        }
        
        .clear {
            background: #e74c3c;
            color: white;
        }
        
        /* વૉઇસ કંટ્રોલ */
        .voice-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 20px;
        }
        
        .mic-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .mic-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border: none;
            color: white;
            font-size: 2.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 10px 20px rgba(231, 76, 60, 0.3);
            z-index: 2;
        }
        
        .mic-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 25px rgba(231, 76, 60, 0.4);
        }
        
        .mic-btn.listening {
            background: linear-gradient(135deg, #27ae60, #229954);
            animation: pulse 1.5s infinite;
            box-shadow: 0 10px 20px rgba(39, 174, 96, 0.4);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .mic-status {
            font-size: 1.1rem;
            color: #333;
            text-align: center;
            min-height: 25px;
            font-weight: 500;
            padding: 5px 10px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }
        
        /* ઇતિહાસ */
        .history-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .history-title {
            color: #0c2461;
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 10px;
            background: white;
            border-radius: 8px;
            font-size: 0.9rem;
            border-left: 4px solid #3498db;
            cursor: pointer;
        }
        
        .history-item:hover {
            background: #e3f2fd;
        }
        
        .history-calculation {
            color: #555;
        }
        
        .history-result {
            font-weight: bold;
            color: #27ae60;
        }
        
        /* ફૂટર */
        .footer {
            text-align: center;
            padding: 15px 0 5px 0;
            color: #666;
            font-size: 0.85rem;
            border-top: 1px solid #eee;
            margin-top: 15px;
        }
        
        .developer-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
        }
        
        .developer-name {
            color: #0c2461;
            font-weight: bold;
        }
        
        .developer-phone {
            color: #27ae60;
            direction: ltr;
            text-decoration: none;
        }
        
        .developer-phone:hover {
            text-decoration: underline;
        }
        
        /* રિસ્પોન્સિવ */
        @media (max-width: 450px) {
            .container {
                padding: 15px;
                border-radius: 20px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .calc-btn {
                height: 65px;
                font-size: 1.3rem;
                border-radius: 12px;
            }
            
            .result-display {
                font-size: 2.2rem;
            }
            
            .mic-btn {
                width: 70px;
                height: 70px;
                font-size: 1.8rem;
            }
        }
        
        @media (max-width: 350px) {
            .calc-btn {
                height: 60px;
                font-size: 1.2rem;
            }
            
            .result-display {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <i class="fas fa-calculator"></i>
                <span class="app-name">Dev Calculator</span>
            </h1>
            <p>વૉઇસ અને ટચ કેલ્ક્યુલેટર</p>
        </div>
        
        <!-- કેલ્ક્યુલેટર ડિસ્પ્લે -->
        <div class="calculator-display">
            <div class="calculation-display" id="calculationDisplay"></div>
            <div class="result-display" id="resultDisplay">0</div>
        </div>
        
        <!-- કેલ્ક્યુલેટર બટન્સ -->
        <div class="calculator-buttons">
            <button class="calc-btn clear" onclick="clearCalculator()">C</button>
            <button class="calc-btn function" onclick="deleteLast()">⌫</button>
            <button class="calc-btn function" onclick="appendToDisplay('%')">%</button>
            <button class="calc-btn operator" onclick="handleOperator('/')">÷</button>
            
            <button class="calc-btn number" onclick="appendToDisplay('7')">7</button>
            <button class="calc-btn number" onclick="appendToDisplay('8')">8</button>
            <button class="calc-btn number" onclick="appendToDisplay('9')">9</button>
            <button class="calc-btn operator" onclick="handleOperator('*')">×</button>
            
            <button class="calc-btn number" onclick="appendToDisplay('4')">4</button>
            <button class="calc-btn number" onclick="appendToDisplay('5')">5</button>
            <button class="calc-btn number" onclick="appendToDisplay('6')">6</button>
            <button class="calc-btn operator" onclick="handleOperator('-')">−</button>
            
            <button class="calc-btn number" onclick="appendToDisplay('1')">1</button>
            <button class="calc-btn number" onclick="appendToDisplay('2')">2</button>
            <button class="calc-btn number" onclick="appendToDisplay('3')">3</button>
            <button class="calc-btn operator" onclick="handleOperator('+')">+</button>
            
            <button class="calc-btn number" onclick="appendToDisplay('0')">0</button>
            <button class="calc-btn number" onclick="appendToDisplay('.')">.</button>
            <button class="calc-btn equals" onclick="calculateResult()" style="grid-column: span 2;">=</button>
        </div>
        
        <!-- વૉઇસ કંટ્રોલ -->
        <div class="voice-control">
            <div class="mic-container">
                <button class="mic-btn" id="micButton">
                    <i class="fas fa-microphone"></i>
                </button>
            </div>
            
            <div class="mic-status" id="statusText">
                માઇક બટન દબાવો
            </div>
        </div>
        
        <!-- ઇતિહાસ -->
        <div class="history-section">
            <div class="history-title">
                <span>ઇતિહાસ</span>
                <button style="background: none; border: none; color: #e74c3c; cursor: pointer; font-size: 0.9rem;" onclick="clearHistory()">
                    સાફ કરો
                </button>
            </div>
            <div class="history-list" id="historyList">
                <!-- ઇતિહાસ આઇટમ્સ અહીં દેખાશે -->
            </div>
        </div>
        
        <!-- ફૂટર -->
        <div class="footer">
            <p>વૉઇસ રેકોગ્નિશન માટે માઇક્રોફોન પરવાનગી આપો</p>
            <div class="developer-info">
                <div class="developer-name">Developed by Devendra Ramanuj</div>
                <a href="tel:+919276505935" class="developer-phone">+91 9276505935</a>
            </div>
        </div>
    </div>

    <script>
        // DOM એલિમેન્ટ્સ
        const calculationDisplay = document.getElementById('calculationDisplay');
        const resultDisplay = document.getElementById('resultDisplay');
        const micButton = document.getElementById('micButton');
        const statusText = document.getElementById('statusText');
        const historyList = document.getElementById('historyList');
        
        // કેલ્ક્યુલેટર સ્ટેટ
        let currentInput = '0';
        let previousInput = '';
        let operator = null;
        let shouldResetScreen = false;
        
        // પેજ લોડ થયે સેટઅપ
        document.addEventListener('DOMContentLoaded', function() {
            updateDisplay();
            loadHistory();
            
            // વૉઇસ રેકોગ્નિશન સેટઅપ
            setupVoiceRecognition();
            
            // કીબોર્ડ સપોર્ટ
            document.addEventListener('keydown', handleKeyPress);
        });
        
        // કેલ્ક્યુલેટર ફંક્શન્સ
        function appendToDisplay(value) {
            if (currentInput === '0' || shouldResetScreen) {
                if (value === '.') {
                    currentInput = '0.';
                } else {
                    currentInput = value;
                }
                shouldResetScreen = false;
            } else {
                if (value === '.' && currentInput.includes('.')) {
                    return;
                }
                currentInput += value;
            }
            updateDisplay();
        }
        
        function handleOperator(op) {
            if (currentInput === '0' && op !== '-') return;
            
            if (operator !== null && !shouldResetScreen) {
                calculateResult();
            }
            
            previousInput = currentInput;
            operator = op;
            shouldResetScreen = true;
            updateDisplay();
        }
        
        function calculateResult() {
            if (operator === null || shouldResetScreen) return;
            
            let computation;
            const prev = parseFloat(previousInput);
            const current = parseFloat(currentInput);
            
            if (isNaN(prev) || isNaN(current)) return;
            
            switch (operator) {
                case '+':
                    computation = prev + current;
                    break;
                case '-':
                    computation = prev - current;
                    break;
                case '*':
                    computation = prev * current;
                    break;
                case '/':
                    if (current === 0) {
                        alert("શૂન્ય વડે ભાગાકાર શક્ય નથી");
                        clearCalculator();
                        return;
                    }
                    computation = prev / current;
                    break;
                case '%':
                    computation = prev % current;
                    break;
                default:
                    return;
            }
            
            // ઇતિહાસમાં ઉમેરો
            const expression = `${formatDisplayNumber(prev)} ${operator} ${formatDisplayNumber(current)}`;
            addToHistory(expression, computation);
            
            // ડિસ્પ્લે અપડેટ
            currentInput = computation.toString();
            operator = null;
            previousInput = '';
            shouldResetScreen = true;
            
            calculationDisplay.textContent = expression + ' =';
            resultDisplay.textContent = formatNumber(computation);
            
            // વૉઇસ આઉટપુટ
            speakAnswer(`જવાબ છે ${formatNumber(computation)}`);
        }
        
        function clearCalculator() {
            currentInput = '0';
            previousInput = '';
            operator = null;
            shouldResetScreen = false;
            updateDisplay();
        }
        
        function deleteLast() {
            if (currentInput.length > 1) {
                currentInput = currentInput.slice(0, -1);
            } else {
                currentInput = '0';
            }
            updateDisplay();
        }
        
        function updateDisplay() {
            resultDisplay.textContent = formatDisplayNumber(currentInput);
            
            if (operator !== null) {
                calculationDisplay.textContent = `${formatDisplayNumber(previousInput)} ${operator}`;
            } else {
                calculationDisplay.textContent = '';
            }
        }
        
        function formatDisplayNumber(num) {
            const number = parseFloat(num);
            if (isNaN(number)) return '0';
            
            return number.toLocaleString('en-IN', {
                maximumFractionDigits: 10
            });
        }
        
        function formatNumber(num) {
            const number = parseFloat(num);
            if (isNaN(number)) return '0';
            
            if (Math.abs(number) >= 1e9) {
                return number.toExponential(2);
            }
            
            return number.toLocaleString('en-IN', {
                maximumFractionDigits: 10
            });
        }
        
        // વૉઇસ રેકોગ્નિશન સેટઅપ
        function setupVoiceRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (SpeechRecognition) {
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'gu-IN';
                
                recognition.onstart = function() {
                    isListening = true;
                    micButton.classList.add('listening');
                    statusText.textContent = "સાંભળી રહ્યા છું...";
                    micButton.innerHTML = '<i class="fas fa-stop"></i>';
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    processVoiceCommand(transcript);
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error', event.error);
                    statusText.textContent = "ત્રુટિ: " + event.error;
                    stopListening();
                };
                
                recognition.onend = function() {
                    stopListening();
                };
            } else {
                statusText.textContent = "તમારો બ્રાઉઝર વૉઇસ રેકોગ્નિશન સપોર્ટ કરતો નથી";
                micButton.disabled = true;
            }
        }
        
        let recognition;
        let isListening = false;
        
        // માઇક બટન ક્લિક
        micButton.addEventListener('click', function() {
            if (!isListening) {
                startListening();
            } else {
                stopListening();
            }
        });
        
        function startListening() {
            if (recognition) {
                try {
                    recognition.start();
                } catch (error) {
                    statusText.textContent = "માઇક્રોફોન એક્સેસની ત્રુટિ";
                }
            }
        }
        
        function stopListening() {
            isListening = false;
            micButton.classList.remove('listening');
            statusText.textContent = "માઇક બટન દબાવો";
            micButton.innerHTML = '<i class="fas fa-microphone"></i>';
        }
        
        // વૉઇસ કમાન્ડ પ્રોસેસ
        function processVoiceCommand(command) {
            console.log("આદેશ: " + command);
            statusText.textContent = `"${command}"`;
            
            let processedCommand = command.toLowerCase();
            
            // વ્યાજ ગણતરી માટે ખાસ હેન્ડલિંગ
            if (processedCommand.includes('વ્યાજ') || 
                processedCommand.includes('interest') || 
                processedCommand.includes('vyaj')) {
                
                handleInterestCalculation(processedCommand);
                return;
            }
            
            // સામાન્ય ગણતરી
            handleNormalCalculation(processedCommand);
        }
        
        // સામાન્ય ગણતરી હેન્ડલિંગ
        function handleNormalCalculation(command) {
            let processedCommand = command;
            
            // ગુજરાતી નંબર અને ઓપરેટર કન્વર્ઝન
            const gujaratiNumbers = {
                'શૂન્ય': '0', 'એક': '1', 'બે': '2', 'ત્રણ': '3', 'ચાર': '4',
                'પાંચ': '5', 'છ': '6', 'સાત': '7', 'આઠ': '8', 'નવ': '9',
                'દસ': '10', 'વીસ': '20', 'ત્રીસ': '30', 'ચાલીસ': '40', 'પચાસ': '50',
                'સાઠ': '60', 'સિત્તેર': '70', 'એંસી': '80', 'નેવું': '90',
                'સો': '100', 'હજાર': '1000', 'લાખ': '100000', 'કરોડ': '10000000'
            };
            
            const gujaratiOperators = {
                'વત્તા': '+', 'પ્લસ': '+', 'ઉમેર': '+', 'જમા': '+',
                'બાદ': '-', 'માઈનસ': '-', 'ઘટાડ': '-', 'ઓછા': '-',
                'ગુણાકાર': '*', 'ગુણ': '*', 'મલ્ટીપ્લાય': '*',
                'ભાગાકાર': '/', 'ભાગ': '/', 'ડિવાઇડ': '/',
                'ટકા': '%', 'પરસેન્ટ': '%',
                'બરાબર': '=', 'ઇક્વલ': '=', 'કેટલું': '=',
                'ડોટ': '.', 'પોઈન્ટ': '.', 'દશાંશ': '.'
            };
            
            // નંબર રિપ્લેસ
            Object.keys(gujaratiNumbers).forEach(gujNum => {
                const regex = new RegExp(gujNum, 'gi');
                processedCommand = processedCommand.replace(regex, gujaratiNumbers[gujNum]);
            });
            
            // ઓપરેટર રિપ્લેસ
            Object.keys(gujaratiOperators).forEach(gujOp => {
                const regex = new RegExp(gujOp, 'gi');
                processedCommand = processedCommand.replace(regex, gujaratiOperators[gujOp]);
            });
            
            // વિશેષ કેસ: ટકા માટે
            processedCommand = processedCommand.replace(/ના\s*(\d+)\s*ટકા/g, ' * $1 / 100');
            processedCommand = processedCommand.replace(/નો\s*(\d+)\s*ટકા/g, ' * $1 / 100');
            processedCommand = processedCommand.replace(/ના\s*(\d+)\s*પરસેન્ટ/g, ' * $1 / 100');
            
            // કલેન કરો
            processedCommand = processedCommand.replace(/[^\d\+\-\*\/\.\%\s]/g, '');
            processedCommand = processedCommand.trim();
            
            console.log("પ્રોસેસ્ડ કમાન્ડ: " + processedCommand);
            
            // જો એક્સપ્રેશન હોય તો કેલ્ક્યુલેટ કરો
            if (processedCommand.includes('+') || processedCommand.includes('-') || 
                processedCommand.includes('*') || processedCommand.includes('/')) {
                
                try {
                    let expression = processedCommand;
                    
                    // % ને /100 માં કન્વર્ટ કરો
                    if (expression.includes('%')) {
                        expression = expression.replace(/%/g, '/100');
                    }
                    
                    const result = eval(expression);
                    
                    // ડિસ્પ્લે અપડેટ
                    currentInput = result.toString();
                    calculationDisplay.textContent = processedCommand + ' =';
                    resultDisplay.textContent = formatNumber(result);
                    
                    // ઇતિહાસ
                    addToHistory(processedCommand, result);
                    
                    // વૉઇસ આઉટપુટ
                    speakAnswer(`જવાબ છે ${formatNumber(result)}`);
                    
                } catch (error) {
                    console.error("ગણતરી ત્રુટિ:", error);
                    speakAnswer("માફ કરશો, ગણતરીમાં ત્રુટિ આવી");
                }
                
            } else if (processedCommand.includes('%')) {
                // ફક્ત ટકા
                const numMatch = processedCommand.match(/(\d+(\.\d+)?)\s*%/);
                if (numMatch) {
                    const percent = parseFloat(numMatch[1]);
                    const currentNum = parseFloat(currentInput);
                    const result = (currentNum * percent) / 100;
                    
                    currentInput = result.toString();
                    calculationDisplay.textContent = `${formatNumber(currentNum)} ના ${percent}% =`;
                    resultDisplay.textContent = formatNumber(result);
                    
                    addToHistory(`${currentNum} ના ${percent}%`, result);
                    speakAnswer(`${currentNum} ના ${percent} ટકા છે ${formatNumber(result)}`);
                }
            } else {
                // માત્ર નંબર
                const numbers = processedCommand.match(/\d+(\.\d+)?/g);
                if (numbers && numbers.length > 0) {
                    clearCalculator();
                    currentInput = numbers[0];
                    updateDisplay();
                    speakAnswer(numbers[0]);
                } else {
                    speakAnswer("કોઈ નંબર સમજાયો નથી");
                }
            }
        }
        
        // વ્યાજ ગણતરી હેન્ડલિંગ
        function handleInterestCalculation(command) {
            console.log("વ્યાજ ગણતરી: " + command);
            
            // નંબરો એક્સટ્રેક્ટ કરો
            const numbers = command.match(/\d+/g);
            
            if (!numbers || numbers.length < 2) {
                speakAnswer("માફ કરશો, મને મૂળધન અને ટકા સમજાયા નથી");
                return;
            }
            
            const principal = parseFloat(numbers[0]);
            const rate = parseFloat(numbers[1]);
            let time = 1;
            
            // સમય એક્સટ્રેક્ટ કરો
            const timeMatch = command.match(/(\d+)\s*વર્ષ|(\d+)\s*સાલ|(\d+)\s*year/i);
            if (timeMatch) {
                for (let i = 1; i <= 3; i++) {
                    if (timeMatch[i]) {
                        time = parseFloat(timeMatch[i]);
                        break;
                    }
                }
            }
            
            // સાદુ વ્યાજ ગણતરી
            const interest = (principal * rate * time) / 100;
            const total = principal + interest;
            
            // ડિસ્પ્લે અપડેટ
            calculationDisplay.textContent = `વ્યાજ = (${principal} × ${rate} × ${time}) / 100`;
            resultDisplay.textContent = formatNumber(interest);
            
            // ઇતિહાસમાં ઉમેરો
            const expression = `₹${formatNumber(principal)} પર ${rate}% ${time} વર્ષનું વ્યાજ`;
            addToHistory(expression, interest);
            
            // વૉઇસ આઉટપુટ
            speakAnswer(`${formatNumber(principal)} રૂપિયા પર ${rate} ટકા દરે ${time} વર્ષનું સાદુ વ્યાજ ${formatNumber(interest)} રૂપિયા છે. કુલ રકમ ${formatNumber(total)} રૂપિયા થાય.`);
        }
        
        // વૉઇસ આઉટપુટ
        function speakAnswer(text) {
            if ('speechSynthesis' in window) {
                const speech = new SpeechSynthesisUtterance();
                speech.text = text.toString();
                speech.lang = 'gu-IN';
                speech.rate = 0.9;
                speech.pitch = 1;
                speech.volume = 1;
                
                window.speechSynthesis.speak(speech);
            }
        }
        
        // કીબોર્ડ સપોર્ટ
        function handleKeyPress(e) {
            const key = e.key;
            
            if (key >= '0' && key <= '9') {
                appendToDisplay(key);
            } else if (key === '.') {
                appendToDisplay('.');
            } else if (key === '+') {
                handleOperator('+');
            } else if (key === '-') {
                handleOperator('-');
            } else if (key === '*') {
                handleOperator('*');
            } else if (key === '/') {
                e.preventDefault();
                handleOperator('/');
            } else if (key === '%') {
                appendToDisplay('%');
            } else if (key === 'Enter' || key === '=') {
                e.preventDefault();
                calculateResult();
            } else if (key === 'Escape' || key === 'Delete') {
                clearCalculator();
            } else if (key === 'Backspace') {
                deleteLast();
            } else if (key === ' ') {
                e.preventDefault();
                micButton.click();
            }
        }
        
        // ઇતિહાસ ફંક્શન્સ
        function addToHistory(expression, result) {
            const now = new Date();
            const timeString = now.toLocaleTimeString('gu-IN', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.innerHTML = `
                <div class="history-calculation">${expression}</div>
                <div class="history-result">${formatNumber(result)}</div>
            `;
            
            historyItem.addEventListener('click', function() {
                clearCalculator();
                currentInput = result.toString();
                updateDisplay();
            });
            
            historyList.prepend(historyItem);
            
            saveHistory(expression, result, timeString);
            
            if (historyList.children.length > 10) {
                historyList.removeChild(historyList.lastChild);
            }
        }
        
        function saveHistory(expression, result, time) {
            let history = JSON.parse(localStorage.getItem('devCalcHistory') || '[]');
            
            history.unshift({
                expression: expression,
                result: result,
                time: time,
                date: new Date().toISOString()
            });
            
            if (history.length > 15) {
                history = history.slice(0, 15);
            }
            
            localStorage.setItem('devCalcHistory', JSON.stringify(history));
        }
        
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('devCalcHistory') || '[]');
            
            history.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-calculation">${item.expression}</div>
                    <div class="history-result">${formatNumber(item.result)}</div>
                `;
                
                historyItem.addEventListener('click', function() {
                    clearCalculator();
                    currentInput = item.result.toString();
                    updateDisplay();
                });
                
                historyList.appendChild(historyItem);
            });
        }
        
        function clearHistory() {
            if (confirm("શું તમે ઇતિહાસ સાફ કરવા માંગો છો?")) {
                historyList.innerHTML = '';
                localStorage.removeItem('devCalcHistory');
            }
        }
    </script>
</body>
</html>
